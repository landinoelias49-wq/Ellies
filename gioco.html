<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gioco dei Gavettoni</title>
<style>
body { margin:0; overflow:hidden; background:skyblue; font-family:Arial;}
canvas { display:block; margin:auto; background:#87ceeb;}
#score {position:absolute; top:10px; left:10px; font-size:2rem; color:white; text-shadow:2px 2px 5px black;}
#winMessage {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:4rem; color:yellow; text-shadow:3px 3px 10px black; display:none;}
</style>
</head>
<body>
<div id="score">Punteggio: 0</div>
<div id="winMessage">ELLIES HA VINTO!!! ðŸŽ‰</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
const scoreDiv = document.getElementById("score");
const winDiv = document.getElementById("winMessage");

// Ellies
let ellies = {x: canvas.width/2, y: canvas.height-120, width:60, height:100};

// Torri uffici
const towers = [];
for(let i=0;i<5;i++){
    towers.push({x:100+i*200, y:200, width:80, height:200, destroyed:false});
}

// Gavettoni
const balls = [];

window.addEventListener("keydown",(e)=>{
    if(e.key==="ArrowLeft") ellies.x -=20;
    if(e.key==="ArrowRight") ellies.x +=20;
    if(e.key===" ") balls.push({x:ellies.x+ellies.width/2, y:ellies.y, radius:10, dy:-7});
});

function drawEllies(){
    // Corpo
    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.moveTo(ellies.x, ellies.y);
    ctx.lineTo(ellies.x, ellies.y+ellies.height);
    ctx.lineTo(ellies.x+ellies.width, ellies.y+ellies.height);
    ctx.lineTo(ellies.x+ellies.width, ellies.y);
    ctx.closePath();
    ctx.fill();
    // Testa
    ctx.fillStyle="#f1c27d";
    ctx.beginPath();
    ctx.arc(ellies.x+ellies.width/2, ellies.y-20, 30,0,Math.PI*2);
    ctx.fill();
    // Barba
    ctx.strokeStyle="#654321";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.arc(ellies.x+ellies.width/2, ellies.y-10, 20,0,Math.PI,false);
    ctx.stroke();
}

function drawTowers(){
    towers.forEach(t=>{
        if(!t.destroyed){
            ctx.fillStyle="#555";
            ctx.fillRect(t.x,t.y,t.width,t.height);
            // finestre
            ctx.fillStyle="#fffae3";
            for(let wx=5;wx<t.width-10;wx+=20){
                for(let wy=5;wy<t.height-10;wy+=20){
                    ctx.fillRect(t.x+wx,t.y+wy,10,10);
                }
            }
        }
    });
}

function drawBalls(){
    balls.forEach((b,i)=>{
        ctx.fillStyle="blue";
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
        ctx.fill();
        b.y += b.dy;

        // Collisione con torri
        towers.forEach(t=>{
            if(!t.destroyed && b.x>t.x && b.x<t.x+t.width && b.y-b.radius<t.y+t.height && b.y+b.radius>t.y){
                t.destroyed=true;
                balls.splice(i,1);
                score += 200;
                scoreDiv.textContent="Punteggio: "+score;
                if(score>=1000){
                    towers.forEach(t2=>t2.destroyed=true);
                    winDiv.style.display="block";
                }
            }
        });

        // fuori schermo
        if(b.y<0) balls.splice(i,1);
    });
}

function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawEllies();
    drawTowers();
    drawBalls();
    requestAnimationFrame(animate);
}
animate();
</script>
<p style="color:white; position:absolute; bottom:10px; left:10px;">Usa frecce sinistra/destra e spazio per lanciare gavettoni</p>
</body>
</html>

