<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Platform 2D – Adventure</title>
<style>
    body { margin:0; overflow:hidden; background:#000; }
    canvas { display:block; background:#222; image-rendering:pixelated; }
</style>
</head>
<body>

<canvas id="game" width="1600" height="900"></canvas>

<script>
/* -------------------------------------------------
   COSTANTI DI GIOCO
------------------------------------------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRAVITY = 1.2;
let keys = {};

document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

let currentLevel = 0;

/* -------------------------------------------------
   GIOCATORE (ARABO IN TUNICA – placeholder)
------------------------------------------------- */
class Player {
    constructor() {
        this.w = 60;
        this.h = 110;
        this.x = 200;
        this.y = 0;

        this.vx = 0;
        this.vy = 0;

        this.speed = 10;
        this.jumpForce = 25;

        this.canDouble = true;
        this.onGround = false;

        this.hp = 5;
    }

    spawn(x,y){
        this.x = x;
        this.y = y;
    }

    update() {
        // movimento orizzontale
        if (keys["ArrowRight"]) this.vx = this.speed;
        else if (keys["ArrowLeft"]) this.vx = -this.speed;
        else this.vx *= 0.8;

        // salto
        if (keys["Space"]) {
            if (this.onGround) {
                this.vy = -this.jumpForce;
                this.onGround = false;
                this.canDouble = true;
            } else if (this.canDouble) {
                this.vy = -this.jumpForce * 0.8;
                this.canDouble = false;
            }
        }

        // gravità
        this.vy += GRAVITY;

        // movimento
        this.x += this.vx;
        this.y += this.vy;

        // collisione col terreno
        if (this.y + this.h > canvas.height - 100) {
            this.y = canvas.height - this.h - 100;
            this.vy = 0;
            this.onGround = true;
        }

        // limiti finestra
        if (this.x < 0) this.x = 0;
        if (this.x + this.w > canvas.width) this.x = canvas.width - this.w;

        // raggiunge la fine del livello
        if (this.x > canvas.width - 120) nextLevel();
    }

    draw() {
        ctx.fillStyle = "#ffe4b5"; // pelle
        ctx.fillRect(this.x, this.y, this.w, this.h);

        // tunica
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(this.x+10, this.y+20, this.w-20, this.h-30);
    }
}

const player = new Player();

/* -------------------------------------------------
   NEMICI SEMPLIFICATI
------------------------------------------------- */
class Enemy {
    constructor(x,y){
        this.x = x;
        this.y = y;
        this.w = 70;
        this.h = 70;
        this.vx = 3;
    }

    update(){
        this.x += this.vx;

        if (this.x < 100 || this.x > canvas.width-200)
            this.vx *= -1;

        if (this.collide(player)) {
            player.hp -= 1;
            player.x -= 50; // knockback
        }
    }

    collide(obj){
        return !(obj.x+obj.w < this.x ||
                 obj.x > this.x+this.w ||
                 obj.y+obj.h < this.y ||
                 obj.y > this.y+this.h);
    }

    draw(){
        ctx.fillStyle = "red";
        ctx.fillRect(this.x,this.y,this.w,this.h);
    }
}

let enemies = [];

/* -------------------------------------------------
   BOSS DEL LIVELLO 10 – DJINN OSCURO
------------------------------------------------- */
class Boss {
    constructor(){
        this.x = 1100;
        this.y = 450;
        this.w = 200;
        this.h = 300;
        this.hp = 20;
        this.phase = 1;
    }

    update(){
        // attacco base
        if (Math.random() < 0.01* this.phase) {
            projectiles.push(new Projectile(this.x,this.y+100));
        }

        // collisione col player
        if (this.collide(player)) {
            player.hp -= 1;
            player.x -= 80;
        }

        // cambio fase
        if (this.hp <= 12) this.phase = 2;
        if (this.hp <= 5) this.phase = 3;
    }

    collide(obj){
        return !(obj.x+obj.w < this.x ||
                 obj.x > this.x+this.w ||
                 obj.y+obj.h < this.y ||
                 obj.y > this.y+this.h);
    }

    draw(){
        ctx.fillStyle = "#5500ff";
        ctx.fillRect(this.x,this.y,this.w,this.h);
    }
}

class Projectile {
    constructor(x,y){
        this.x=x;
        this.y=y;
        this.vx = -8;
        this.w=40;
        this.h=20;
    }

    update(){
        this.x += this.vx;

        if (this.collide(player)) {
            player.hp -= 1;
            this.x = -999;
        }
    }

    collide(obj){
        return !(obj.x+obj.w < this.x ||
                 obj.x > this.x+this.w ||
                 obj.y+obj.h < this.y ||
                 obj.y > this.y+this.h);
    }

    draw(){
        ctx.fillStyle="purple";
        ctx.fillRect(this.x,this.y,this.w,this.h);
    }
}

let boss = null;
let projectiles = [];

/* -------------------------------------------------
   LIVELLI 1–10
------------------------------------------------- */
const LEVELS = [
    "Oasi del Deserto",
    "Dune Danzanti",
    "Tempio Antico",
    "Caverne di Cristallo",
    "Mercato Notturno",
    "Giardini Reali",
    "Città Dorata",
    "Portali degli Spiriti",
    "Fortezza del Sultano",
    "Il Djinn Oscuro – BOSS"
];

function loadLevel(n){
    enemies = [];
    projectiles = [];
    boss = null;

    player.spawn(150,400);

    // genera nemici base
    for (let i=0;i<n+2;i++){
        enemies.push(new Enemy(500 + i*200, 650));
    }

    // livello 10: boss
    if (n === 9) boss = new Boss();
}

/* -------------------------------------------------
   CAMBIO LIVELLO
------------------------------------------------- */
function nextLevel(){
    currentLevel++;
    if (currentLevel >= LEVELS.length) currentLevel = 0; // fine
    loadLevel(currentLevel);
}

/* -------------------------------------------------
   LOOP DI GIOCO
------------------------------------------------- */
loadLevel(0);

function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // sfondo
    const grd = ctx.createLinearGradient(0,0,0,canvas.height);
    grd.addColorStop(0,"#0a0a0a");
    grd.addColorStop(1,"#202020");
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // HUD
    ctx.fillStyle="#fff";
    ctx.font="40px Arial";
    ctx.fillText("Livello: " + LEVELS[currentLevel], 40,60);
    ctx.fillText("HP: " + player.hp, 40,120);

    // update/logica
    player.update();
    enemies.forEach(e=>e.update());
    projectiles.forEach(p=>p.update());
    if (boss) boss.update();

    // draw
    enemies.forEach(e=>e.draw());
    projectiles.forEach(p=>p.draw());
    if (boss) boss.draw();
    player.draw();

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>





